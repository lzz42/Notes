# 高效程序的奥秘

## 基础

- 计算机运算与数学运算的区别
  - 操作数不同
  - 运算符扩充
  - Main Deference：使用模2指数简化加法、减法、乘法
  - 大数操作、逻辑运算
  - 如无特殊说明：字长为32b,有符号整型和无符号整型均使用二进制的补码形式
- 将一个计算机字长视为一个单一字节的向量
- 字节从右开始计数，最右侧计数为0
- 十六进制表示：0x
- 二进制表示：0b
- 记法
  - 运算符优先级

| 优先度 | C                 | 说明              |
| ------ | ----------------- | ----------------- |
| 16     | a[k]              | 选择分量          |
| 16     | f(x)              | 函数求值          |
| 15     | x++,x--           | 后置递增 后置递减 |
| 14     | ++x,--x           | 前置递增 前置递减 |
| 14     | (类型名)x         | 类型转换          |
| 14     | ~x                | 按位取反          |
| 14     | !x                | 逻辑取反          |
| 14     | -x                | 算术取负          |
| 13L    | x*y x/y x%y       | 乘法 除法 求余    |
| 12L    | x+y x-y           | 加法 减法         |
| 11L    | x<<y  x>>y        | 带0填充 左/右移位 |
| 10L    | x<y x<=y x>y x>=y | 有/无符号比较     |
| 9L     | x==y x!=y         | 相等 不等         |
| 8L     | x&y               | 按位与            |
| 7L     | x^y               | 按位异或          |
| 6L     | x \| y            | 按位或            |
| 5L     | x&&y              | 条件与            |
| 4L     | x\|\|y            | 条件或            |
| 2R     | x=y               | 赋值              |

- 指令集与运行时间模型
  - 基本RISC指令集
  - 完全RISC附加指令
- 操作最右侧
- 公式1：将一个字的最右侧的1位改为0位
  - `x&x(x-1)`
  - 若没有1位则生成所有位为0的字
  - 用途：
    - 1.检测一个无符号整数是否为2的幂（需要0-检测）
- 公式2：检测一个无符号整数是否为$2^n-1$的形式
  - `x&(x+1)`
- 公式3：
  - 析出isolate最右侧1位：`x&(-x)`
  - 析出最右侧0位：`~x&(x+1)`
- 公式4：识别后缀0的掩码
  - `~x&(x-1)` （具有指令并行）
  - `~(x|-x)`
  - `(x&-x)-1`
- 公式5：识别最右侧1位和后缀0的掩码
  - `x^(x-1)`
- 公式6：