# CH13 IO输入系统

## 1.概述

- 设备驱动程序

## 2.IO硬件

- 总线，控制器
- IO端口，寄存器，设备控制器：

### 2.2 中断

- 中断基本机制：
  - 1.CPU硬件：一条中断请求线（Interrupt-request line，IRL）
  - 2.CPU执行完每条指令后，检测IRL是否具有中断信号；
  - 3.若检测到中断信号，CPU保存当前状态，CPU跳转到内存固定位置的中断处理程序，中断处理程序进行中断处理
  - 4.中断处理完后，CPU返回中断前位置，恢复中断前状态，继续执行
  - 5.若未检测到中断信号，CPU继续执行下一条指令
- IO设备引起中断 raise--->CPU捕获中断 catch--->CPU分发中断dispatch--->中断处理程序处理中断，设备清除中断状态clear
- 中断处理特性：
  - 1.CPU进行关键处理时，CPU能延迟中断处理；
  - 2.CPU更为有效的中断分发到合适的中断处理程序；
  - 3.多级中断，OS区分中断优先级和紧迫性；
- 中断控制器interrupt-controller
- CPU中断请求线：
  - 1.非屏蔽中断
  - 2.可屏蔽中断
- 中断向量interrupt vector：
- 中断优先级interrupt priority
- OS启动时，OS检测硬件状态，将硬件的中断处理程序安装到中断向量
- 中断与OS交互：
  - 1.虚拟内存分页
  - 2.系统调用
  - 3.管理内核控制流
- 总结：
  - 1.处理异步事件
  - 2.设置陷阱进入内核模式

### 直接内存访问

- 处理大量传输设备问题：Programmed IO PIO
- 专用处理器：直接内存访问处理器（DMA direct-memory access）
- 处理大量数据：CPU---发送DMA命令--->DMA--->IO设备控制器
- DMA与设备控制器
  - 握手：DMA-request线，DMA-acknowledge线
- 周期挪用 cycle stealing
- 直接虚拟内存访问 direct virtual-memory access DVMA

### IO硬件总结：

- 1.总线
- 2.控制器
- 3.IO端口与寄存器
- 4.主机与设备控制器之间握手关系
- 5.通过轮询检测或者中断进行握手
- 6.将大量传输任务下放给DMA控制器

## IO应用接口

- IO设备特点：
  - 1.数据传输模式：字节流、块；
  - 2.访问方法：随机访问、顺序访问；
  - 3.传输调度：同步、异步；
  - 4.共享：专用、可共享；
  - 5.设备速度：
  - 6.IO方向：只读、只写、读写；
- 块与字节流设备：
  - 1.原始IO、直接IO
- 网络设备：一般使用socket接口进行网络IO
- 时钟与定时器
  - 可编程间隔定时器promgrammable interval timer
