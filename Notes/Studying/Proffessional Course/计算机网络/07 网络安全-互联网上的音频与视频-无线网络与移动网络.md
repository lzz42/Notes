# 07 网络安全-互联网上的音频与视频-无线网络与移动网络

## 07 网络安全

### 7.1 网络安全问题概述

- 被动攻击：截获、流量分析
- 主动攻击：篡改、恶意程序、拒绝服务DoS
- 安全的计算机网络
  - 1.保密性：
  - 2.端点鉴别
  - 3.信息的完整性
  - 4.运行的安全性
- 数据的加密模型：
  - 密码学cryptology
  - 明文X，加密算法E,解密算法D,密文Y，秘钥K
  - 一般加密表示法：$Y = E_K(X)$ - 密码编码学cryptography
  - 一般解密表示法：$X = D_K(Y)$ - 密码分析学cryptanalysis

### 7.2 两类密码体制

- 对称秘钥密码体制
  - 加密秘钥与解密秘钥使用相同的密码
  - DES保密性仅取决于对秘钥的保密，算法公开
  - 一般DES 56位长秘钥
  - 三重DES：$Y = DES_{K1}(DES^{-1}_{K2}(DES_{K1}(X)))$
  - AES 采用Rijndael算法
  - 应用：一对一加密通信
- 非对称秘钥密码体制（公钥密码体制）
  - 使用不同的加密秘钥与解密秘钥
  - 解决：秘钥分配问题，数字签名需求
  - 目前采用RSA，基于数论中的大数分解问题，
  - 公钥PK公开，私钥SK需要保密，加密算法和解密算法公开
  - 特点：
    - 1.秘钥对产生器产生接收者B一对秘钥：公钥$PK_B$，私钥$SK_B$,发送者A使用的加密秘钥为$PK_B$，B接收者使用解密秘钥为$SK_B$
    - 2.A加密发送：A--Y-->B:$Y = E_{PK_B}(X)$,B解密接收：$X = D_{SK_B}(Y)$
    - 3.从公钥推导出私钥基本上不可能；
  - 应用：多对一加密通信

### 7.3 数字签名

- 数字签名功能：
  - 1.报文鉴别
  - 2.报文完整性
  - 3.不可否认
- 数字签名过程：
  - 发送者签名：A使用其私钥$SK_A$对报文（明文）X进行D运算，得到不可读的报文Y，A将Y发送给B
  - 接收者核实签名：B收到密文Y后，使用A的公钥$PK_A$对密文Y进行E运算，还原出明文X
- 数字签名并未对报文本身进行加密，仅仅是对报文进行了签名，可采用以下方式发送具有保密性的数字签名
  - 发送：A将明文X进行签名（使用A的私钥进行D运算）得到密文$Y_1 = D_{SK_A}(X)$,然后使用B的公钥进行加密（E运算）得到密文Y，即$Y=E_{PK_B}(D_{SK_A}(X))$,然后将Y发送给B
  - 互联网传输的密文为：$Y=E_{PK_B}(D_{SK_A}(X))$
  - 接收：B接收到密文Y后，进行解密（使用B的私钥进行D运算）得到A签名的密文$Y_1=D_{SK_A}(X)$，然后进行核实签名（使用A的公钥进行E运算）得到明文X

### 7.4 鉴别 authentication

- 鉴别：验证通信的对方的确是自己所要通信的对象，并非冒充者，并且所传递的报文的完整的，并未被篡改

#### 7.4.1 报文鉴别

- 报文鉴别：针对收到的报文鉴别报文的发送者
- 密码散列函数
  - 针对长报文找到一种相对简单的方法对报文进行鉴别
- 散列函数特点：
  - 1.函数输入长度不固定，但输出长度固定，输出值为散列值
  - 2.不同散列值肯定对应不同的输入，但是不同的输入可能计算得到相同的散列值
- 单向函数
- 实用密码散列函数：MD5 SHA-1
  - MD5:MD Message Digest报文摘要
  - SHA：安全散列算法 Secure Hash Algorithm
- MD5算法过程：
  - 1.追加：将任意长度报文按照模$2^{64}$计算余数（64位），追加在报文后面；
  - 2.填充：在报文和余数之间填充1-512位，使填充后长度为512的整数倍，填充首位1，其余为0
  - 3.将追加以及填充后的报文分割为512位的数据块，每个数据块报文再次分为4个128位数据块，每个128位数据块进行4轮不同散列函数计算，每次计算按照32位小数块进行运算，最后得出128位的MD5值
- 报文鉴别码
  - 1.用户A将要发送的报文明文X计算散列值$H = H(x)$
  - 2.将H使用秘钥K进行加密后，拼到明文X后面，生成扩展报文(E(X),H)
  - 3.用户B收到扩展报文后，拆分散列值H与明文X,使用秘钥K对H进行解密,并计算X散列值与解密的H对比，进行报文鉴别
- 报文鉴别码MAC = E(H)
- 特点：不需要整个报文的加密
- MAC标准：HMAC
- 基于公钥系统的报文鉴别：A发送时，使用A的私钥对H进行加密

#### 7.4.2 实体鉴别

- 实体鉴别：系统接入的全部持续时间内对和自己通信的对方实体只需验证一次
- 重放攻击 replay attack IP欺骗
- 简单方式：
  - 发送：A使用共享对称秘钥$K_{AB}$加密带有A身份信息和口令的报文给B
  - 接收：B收到报文后，使用共享对称密钥$K_{AB}$解密数据，确认A身份
  - 缺点：报文被截获后，容易实现重放攻击与IP欺骗
  - 修正：采用不重数nonce方式，用于区分重放的鉴别请求与新的鉴别请求
    - 发送：A使用明文发送A身份信息与不重数$R_A$给B
    - 接收：B收到明文后使用共享密钥$K_{AB}$对$R_A$进行加密后并添加不重数$R_B$，发送给A
    - 响应：A收到B的回复后，使用共享秘钥$K_{AB}$对$R_B$加密后，发送给B

### 7.5 密钥分配

- 密码管理：密钥产生、分配、注入、厅、使用

#### 7.5.1 对称密钥的分配

- 对称密钥分配过程存在的问题：
  - 1.密钥数量大，$n^2问题$
  - 2.密钥如何安全的传送
- 密钥分配中心KDC Key Distribution Center
  - 给需要秘密通信的双方提供临时会话密钥

![alt](res\计算机网络-7-网络安全-KDC对会话密钥的分配.png)

- 目前互联网建议的密钥分配协议Keberos V4：包含鉴别AS与KDC

![alt](res\计算机网络-7-网络安全-Kerberos的工作原理.png)

#### 7.5.2 公钥的分配

- CA认证中心Certification Authority

### 7.6 互联网使用的安全协议

#### 7.6.1 网络层安全协议

- IPsec协议族，IP层提供的通信安全的框架
- IPsec协议族划分:
  - 1.IP安全数据报格式协议：鉴别首部AH Authentication Header协议和封装安全有效载荷ESP(Encapsulation Security Payload)协议
  - 2.加密算法的三个协议
  - 3.互联网密钥交换协议IKE Internet Key Exchange
- IP安全数据报格式：
  - AH协议提供源点鉴别、数据完整性，但不提供保密
  - ESP协议提供源点鉴别、数据完整性、保密，AH协议已包含在ESP协议中
  - IP安全数据报：使用ESP或者AH协议的数据报
  - IP安全数据报工作方式：
    - 1.运输方式transport mode
    - 2.隧道方式tunnel mode
- 安全管理SA Security Association
  - 定义：在发送IP安全数据报之前，在源实体和目的实体直接创建的一条网络层的逻辑连接
  - SA是从源实体到目的实体的单向连接
  - SA状态信息：
    - 1.32位的连接标识符，安全参数索引SPI Security Parameter Index
    - 2.SA的源点和终点IP地址
    - 3.所使用的加密类型
    - 4.加密密钥
    - 5.完整性的检查类型
    - 6.鉴别使用的密钥
- IP安全数据报的格式

![alt](res\计算机网络-7-网络安全-IP安全数据报格式.png)

- IPSec其他构件
  - 安全关联数据库SAD Security Association Database : 用于SA存放的位置
  - 安全策略数据库SPD Security Policy Database :  用于指明何种数据报需要IPSec处理
  - 互联网密钥交换IKE Internet Key Exchange : 用于为安全数据报创建SA
    - IKE构成：
      - 1.密钥生成协议：Oakley协议
      - 2.密钥交换协议：安全密钥交换机制SKEME Security Key Exchange Mechanism
      - 3.定义IKE中的密钥交换：互联网安全关联和密钥关联协议ISAKMP Internet Security Association and Key Management Protocol

#### 7.6.2 运输层安全协议

- 安全套接字SSL Security Socket Layer
- 运输层安全TSL Transport Layer Security
- SSL:
  - 位于HTTP与运输层之间，基于TCP构建的安全通道
- TLS：
  - 基于SSL 3.0上设计的TLS，为所有基于TCP网络应用提供安全数据传输服务
- 安全电子交易协议SET Secure Electronic Transaction:用于互联网上进行安全信用卡交易的协议
- HTTPS使用SSL服务，443端口

![alt](res\计算机网络-7-网络安全-运输层安全协议示意图.png)

- SSL提供的安全服务：
  - SSL服务器鉴别
  - SSL客户端鉴别
  - 加密的SSL会话
- SSL工作过程
  - 1.协商加密算法
  - 2.服务器鉴别
  - 3.会话密钥计算
  - 4.安全数据传输

#### 7.6.3 应用成安全协议

- 电子邮件安全协议PGP Pretty Good Privacy

### 7.7 系统安全：防火墙与入侵检测

- 防火墙Firewall
  - 分组过滤路由器
  - 应用网关或代理服务器
- 入侵检测系统IDS Intrusion Detection System
  - 入侵检测方法：
    - 基于特征的入侵检测
    - 基于异常的入侵检测

### 7.8 未来发展

- 椭圆曲线密码
- 移动安全
- 量子密码

### 本章重要概念

- 计算机网络威胁、计算机网络安全内容、
- 密码编码学、密码分析学、无条件安全
- 对称密码体制 DES ASE、公钥密码体制 RSA
- 数字签名、鉴别、报文摘要MD SHA-1
- 密钥管理、密钥的分配问题、认证中心
- 网络层IPsec协议族
- 运输层的SSL TLS
- 应用成安全协议 电子邮件安全协议PGP
- 防火墙与入侵检测

## 8 互联网上的音频与视频服务

### 8.1 概述

- 多媒体信息特定：
  - 1.信息量大
  - 2.传输数据时，对于延时要求较高
- 互联网视音频服务
  - 1.流式存储音频视频 streaming
  - 2.流式实况音频视频
  - 3.交互式音频视频

### 8.2 流式存储音频视频

- 传统浏览器下载视音频文件
  - 1.浏览器GET请求服务器指定视音频文件
  - 2.服务器发送含有此文件的响应
  - 3.浏览器下载完整个文件后，将该文件交给播放器播放
- 具有元文件的万维网服务器
  - 元文件：metafile 用于描述其他文件的重要信息
  - 1.浏览器请求元文件
  - 2.服务器返回元文件响应
  - 3.浏览器接收响应 解析元文件
  - 4.浏览器将解析后的元文件交给播放器
  - 5.播放器 使用元文件中的URL直接与万维网服务器建立TCP，发送请求报文，下载指定的视音频文件
  - 6.万维网服务器根据收到的HTTP请求报文回复指定的视音频文件的响应报文
- 媒体服务器
![alt](res\计算机网络-8-互联网上传输视音频-使用媒体服务器.png)
  - 分开的服务：普通万维网服务器、媒体服务器（流式服务器）
- 实时流式协议RTSP
![alt](res\计算机网络-8-互联网上传输视音频-使用TCP传送流式视频.png)
  - Real-Time Streaming Protocol
  - RTSP本身不传送数据，仅用于媒体播放器控制多媒体流的传输
  - 工作方式：C/S，位于应用层的有状态的协议

### 8.3 交互式视音频

- IP电话
- IP电话网关
- IP电话所需的几种协议
  - 信令协议：用于在互联网上找到用户
  - 话音分组协议：用于话音数据在互联网的传递
- RTP协议 实时运输协议
  - RTP分组首部结构
- RTCP协议
  - RTP Control Protocol 
  - 主要功能：服务质量的监视与反馈、媒体间的同步、多播组中成员的标识
  - 使用UDP传送
- H.323
  - IP电话信令标准
  - 是一个协议族，包括：系统和构件描述、呼叫模型描述、呼叫信令描述、控制报文、复用、话音编解码、视像编解码、数据协议
- 会话发起协议SPI
  - SIP Session Initiation Protocol
  - SPD

### 8.4 改进“尽最大努力交付”的服务

- 使互联网提供服务质量
  - 不同分组进行标记
  - 对输入分组进行分类
  - 对数据流进行通信量管制与调度
  - 呼叫接纳
- 调度与管制机制
  - 调度机制
    - 排队规则
    - FIFO
    - 按优先级FIFO
    - 加权平均排队WFQ
  - 管制机制
    - 漏桶管制器
    - 漏桶管制与加权平均组合
  - 综合服务IntServ与资源预留协议RSVP
  - 区分服务DiffServ

## 9 无线网络和移动网络

### 9.1 无线局域网WLAN

- 无线局域网的组成
  - 具有固定基础设施：IEEE 802.11
  - 无固定基础设施：
- 802.11
  - 采用星型拓扑，中心点称为接入点AP access point
  - MAC层使用：CSMA/CA协议，
  - 802.11局域网称为Wifi Wireless-Fidelity
  - 基本构件：基本服务集BSS Basic Service Set：BSS包括：一个基站和多个移动站
  - SSID服务集标识 Service Set IDentifier:构件AP时必须给AP分配不超过32位的SSID和一个通信信道
  - BSA Basic Service Area 基本服务区：一个BSS所覆盖的地理范围
  - DS Distribution System分配系统，一个BSS通过AP连接到一个DS构成一个扩展服务集ESS Extension Service Set