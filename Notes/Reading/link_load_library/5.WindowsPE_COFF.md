# Windows PE/COFF

## 5.1 Windows的二进制文件格式PE/COFF

- PE:Protable Executable,是COFF的扩展，基于DEC，基于段的结构
- 64位PE文件结构称为：PE32+
- 基于段的结构（不同的编译器产生的段名不同）
  - .code:代码段
  - .data:数据段
- 可以在程序中指定段名：
  - (VC++)：`#pragrma data_seg("Foo")`

```C
#pragrma data_seg("Foo")
int global_int_v1 =90;
#pragrma data_seg(".data")
int global_int_v2 =91;

```

## 5.2 PE前身--COFF

- VC++操作
  - 1.汇编（.obj的目标文件）：`cl /c /Za hello.c`
    - /c:只编译不链接；/Za:禁用扩展（使用该参数时，自动定义宏"__STDC__"）
  - 2.查看目标根据结构：`dumpbin /ALL hello.obj > hello.txt`
- COFF文件结构
  - 文件头(映像头+段表信息)+段表+符号表+调试表