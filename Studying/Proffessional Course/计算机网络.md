# 计算机网络 - 谢希仁

![alt](计算机网络.png)

## Chapter 01 概述

- Glossary
- ISP Internet Service Provider 因特网服务提供者
- C/S -Client Server  客户端服务器
- P2P - peer-to-peer 对等连接
- 带宽 - bandwidth
- 吞吐量 - throughput
- 时延 - delay latency
- 发送时延 -  transmission delay
- 传播时延 - propagation delay
- 总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延
- 网络协议的三要素：
  - 1.语法 - 数据和控制信息的结构或格式；
  - 2.语义 - 发送的控制信息、接收响应、接收动作；
  - 3.同步 - 事件实现顺序；
- 分层后功能：
  - 1.差错控制
  - 2.流量控制
  - 3.分段和重装
  - 4.复用和分用
  - 5.连接建立和释放

| OSI协议    | TCP/IP     | 五层协议模型 |
| ---------- | ---------- | ------------ |
| 应用层     | 应用层     | 应用层       |
| 表示层     | 应用层     | 应用层       |
| 会话层     | 应用层     | 应用层       |
| 运输层     | 运输层     | 运输层       |
| 网络层     | 网际层     | 网络层       |
| 数据链路层 | 网络接口层 | 数据链路层   |
| 物理层层   | 网络接口层 | 物理层       |

- OSI - 七层协议体系：物理层》》数据链路层》》网络层》》运输层》》会话层》》表示层》》应用层
- TCP/IP - 四层协议：网络接口层》》网际层》》运输层》》应用层
- 五层协议模型：物理层》》数据链路层》》网络层》》运输层》》应用层
- 每一层大致作用：
  - 物理层 physical layer ：

| 层名称     | 英文              | 传输单位       | 作用                                    | 其他                        |
| ---------- | ----------------- | -------------- | --------------------------------------- | --------------------------- |
| 应用层     | application layer | 数据           | 为用户提供服务                          | HTTP SMTP DNS RTP H.323 SIP |
| 运输层     | transport layer   | 报文段 segment | 提供复用和分用 TCP UDP                  | TCP UDP   SCTP              |
| 网络层     | network layer     | IP数据报       | 将上层数据封装分组或包                  | IP                          |
| 数据链路层 | data link layer   | 帧 frame       | 控制数据传输，将上层数据封装帧+控制信息 | IP                          |
| 物理层     | physical layer    | byte流         | 物理传输信号                            |                             |

## chapter 02 物理层

- 数据通信系统模型
  - 源系统----传输系统----目的系统
- 信道 channel
  - 定义：向某一方向传送信息的媒体，一条通信电路包含：一条发送信道、一条接收信道
  - 通信方式：
    - 1.单向通信 - 单工通信
    - 2.双向交替通信 - 半双工通信
    - 3.双向同时通信 - 全双工通信
  - 基带信号、调制（modulation）、载波carrier
  - 基带调制：对基带信号进行波形变换
  - 带通调制：把基带信号频率范围移动到较高频段
    - 1.调幅AM 2.调频FM 3.调相PM
  - 信道的极限容量：
    - 1.信道能够通过的频率范围；
    - 2.信噪比
- 物理层传输媒体：
  - 1.双绞线、光缆、卫星
- 信道复用技术
  - 频分复用FDM、时分复用、统计时分复用
  - 波分复用WDM
  - 码分复用CDM - CDMA码分多地址

## chapter 03 数据链路层

- 目的：在物理层的基础上，控制数据的传输（发送、接收）；
- 具体工作：发送：将网络层的数据包装成帧发送到数据链路上，接收：从数据链路上接收到的帧的数据交给网络层；
- 步骤：1.封装成帧（发送）；2.透明传输（发送）；3.差错校验（发送/接收）；
- 硬件设备：网络适配器(网卡)
- 两种类型：
  - 点对点信道
  - 广播信道
- 点对点信道
  - 封装帧：`SOH [数据]EOT`，SOH - 0x01,EOT - 0x04
  - 透明传输：解决数据中出现SOH EOT的问题  - 字符填充（字节填充）- 加ESC转义字符，若出现ESC转义字符则再添加一个ESC,ESC - 0x1B
  - 差错校验：解决传输过程中比特差错问题，误码率EBR - 采用CRC 循环冗余检验（待发送数据后添加n位校验码）
- PPP - 点对点协议
  - 组成：
    - 1.将IP数据报封装到串行链路的方法；
    - 2.链路控制协议LCP：建立、配置、测试数据链路；
    - 3.网络控制协议NCP：
  - PPP协议帧格式

## chapter 04 网络层

- 网络层主要解决问题？提供何种服务？
- 重要概念
  - 1.虚拟互联网络
  - 2.IP地址与物理地址
  - 3.子网掩码和CIDR
  - 4.路由选择协议
  - 5.VPN NAT
  - 6.MPLS

### 4.1 网络层提供的基本服务

- 网络层提供哪两种基本服务？服务特点？

### 4.2 网际协议IP

- IP协议是什么？解决什么问题？
- IP基本结构？

### 4.3 划分子网与构造超网

- 为什么要划分子网？如何划分子网？
- 为什么要构造超网？如何构造超网？

### 4.4 ICMP

- ICMP解决什么问题？
- 如何实现ICMP？

### 4.5 互联网路由选择协议

- 路由选择协议为解决什么问题？
- 路由选择协议有哪些？

### 4.6 IPv6

- IPv6存在意义？
- IPv6基本结构
- IPv6与IPv4区别
- 如何从IPv4到IPv6过渡？

### 4.7 IP多播

- 什么是IP多播？
- IP多播为解决什么问题？
- 如何实现IP多播？

### 4.8 VPN和NAT

- 什么是VPN、NAT？
- VPN和NAT为解决什么问题？

### 4.9 MPLS

- 什么是MPLS?
- MPLS存在意义？
- MPLS应用

## Chapter 05 运输层

- 运输层主要解决什么问题？主要提供什么服务？
- 重要概念：
  - 1.逻辑通信
  - 2.端口和套接字
  - 3.UDP
  - 4.TCP
  - 5.不可靠网络上的可靠传输
  - 6.停止等待协议
  - 7.ARQ协议
  - 8.TCP-滑动窗口、流量控制、拥塞控制、连接管理

### 5.1 运输层协议概述

- 运输层与网络层区别：
  - 网络层为主机之间提供逻辑通信
  - 运输层为应用进程之间提供端到端的逻辑通信
- 运输层的重要功能：
  - 1.复用 multipexing:发送方不同进程可共用同一运输层协议传输数据；
  - 2.分用 demultipexing:接收方运输层能够去掉报文首部后，将数据正确交付目的应用进程；
  - 3.差错检测：接收方对收到的报文进行差错检测
- 运输层目前只有两中运输协议：
  - UDP：无连接，用户数据报协议 User Datagram Protocol，基于IP协议，TPDU：UDP用户数据报
  - TCP：面向连接,传输控制协议 Transport Control Protocol，基于IP协议，TPDU：TCP报文段 segment
- 名词
  - TPDU Transport Protocol Data Unit 运输协议数据单元
- 应用成协议和运输层协议对照表

| 应用           | 应用层协议            | 运输层 |
| -------------- | --------------------- | ------ |
| 名字转换       | DNS 域名系统          | UDP    |
| 文件传送       | TFTP 简单文件传送协议 | UDP    |
| 路由选择协议   | RIP 路由信息协议      | UDP    |
| IP地址配置     | DHCP 动态主机配置协议 | UDP    |
| 网络管理       | SNMP 简单网络管理协议 | UDP    |
| 远程文件服务器 | NFS 网络文件系统      | UDP    |
| IP电话         | 专用协议              | UDP    |
| 流式多媒体通信 | 专用协议              | UDP    |
| 多播           | IGMP 网际组管理协议   | UDP    |
| 电子邮件       | SMTP 简单邮件传送协议 | TCP    |
| 远程终端接入   | TELNET 远程终端协议   | TCP    |
| 万维网         | HTTP 超文本传输协议   | TCP    |
| 文件传送       | FTP 文件传送协议      | TCP    |

- 运输层端口
  - 协议端口号 protocol port number(端口):仅用于本地计算机进程和运输层交互的层间接口
  - TCP/IP：使用16位端口号：0-65535
- 端口号分类：
  - 1.服务器使用的端口号
    - 1.1 熟知端口号或系统端口号：0-1023 (www.iana.org)
    - 1.2 登记端口号：1024-49151
  - 2.客户端使用的端口号：49152-65535

| FTP | TELNET | SMTP | DNS | TFTP | HTTP | SNMP | SNMP(trap) | HTTPS |
| --- | ------ | ---- | --- | ---- | ---- | ---- | ---------- | ----- |
| 21  | 23     | 25   | 53  | 69   | 80   | 161  | 162        | 443   |

### 5.2 UDP

- UDP特点：
  - 1.无连接：发送前不需要建立连接、发送结束不需要释放连接；
  - 2.使用尽最大努力交付，不保证可靠交付
  - 3.面向报文：一次发送一个报文，一次交付一个完整报文;发送方对上层交付的报文，添加首部后就交付给IP层，即不合并也不拆分，保留报文的边界；接收方收到IP层交付的报文，去除首部后交付给上层;
  - 4.没有拥塞控制
  - 5.支持一对一、一对多、多对一、多对多交互通信
  - 6.首部开销小：首部只有8字节
- UDP首部格式
  - UDP数据报=数据字段+首部字段

$$
\begin{aligned}
UDP数据报 & = IP首部 + IP数据报数据部分\\
& = IP首部 + UDP首部 + UDP数据部分\\
& = IP首部 + 源端口(2) + 目的端口(2) + 长度(2) + 检验和(2) + UDP数据部分\\
\end{aligned}
$$

$$
\begin{aligned}\\
UDP首部
& = 源端口(2)：源端口号，需要回信时选用，不需要时，用全0\\
& = 目的端口(2)：目的端口号，终点交付报文时必须\\
& = 长度(2)：UDP用户数据长度，最小值为8（仅首部）\\
& = 检验和(2)：检测UDP数据报在传输中是否有差错，若有差错则丢弃\\
\end{aligned}
$$

为计算首部中的校验和，需要在首部前添加12字节伪首部，组成临时用于计算校验和的数据报，仅有用计算校验和

- 计算过程
  - 1.生成：含伪首部的数据报不是偶数字节补0，按二进制反码计算16位和，结果取反放入检验和；
  - 2.检验：含伪首部的数据报，按二进制反码计算16位和，结果全1时，无差错时；

$$
\begin{aligned}\\
伪首部
& = 源IP地址(4)\\
& = 目的IP地址(4)\\
& = 长度(2)：UDP用户数据长度，最小值为8（仅首部）\\
& = 检验和(2)：检测UDP数据报在传输中是否有差错，若有差错则丢弃\\
\end{aligned}
$$

### 5.3 TCP

- TCP特点：
  - 1.面向连接的运输协议；
  - 2.每条TCP连接只能有两个端点（endpoint），即点对点通信；
  - 3.提供可靠交付服务：无差错、不丢失、不重复、按序到达；
  - 4.提供全双工通信；
  - 5.面向字节流：流-流入到进程或从进程流出的字节序列，不保证发送方的数据块和接收方数据块大小一致，但流保证一致；
- 名词定义：
  - 套接字（socket）或插口：TCP连接的端点，IP地址+端口号

### 5.4 可靠传输工作原理

- 理想传输条件（自然实现可靠传输）：
  - 1.传输信道不产生差错；
  - 2.接收方总能及时处理接收到的数据

#### 5.4.1 停止等待协议

- 概述：发送方每发送完一个分组等待接收方确认，收到接收方确认后再发送下一个分组；
- 无差错情况：
  - A发送分组M给B，等待B回复确认；
  - B收到分组M，进行验证，验证通过，回复接收M确认；
- 出现差错：
  - A发送分组M给B，等待B回复确认；
  - B收到分组M，进行验证，验证失败，丢弃该分组，不发送回复确认；
  - A等待回复超时，重复发送分组M，并等待B确认；
  - 注意：
    - 1.发送者暂时保留已发送数据的副本，以用来重复发送；
    - 2.分组和确认分组都必须进行编号；
    - 3.超时时间设定；
- 确认丢失和确认迟到：
  - 情况：B发送的回复确认丢失
